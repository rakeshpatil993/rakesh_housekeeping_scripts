pipeline{
    agent any
    
    environment {
        EXAMPLE_CREDS = credentials('rak-credentials-id')
    }
 
stages {
            stage('check input parameter'){
            steps{
                      echo "${params.db_server_list}"
                      echo "${params.unix_user_pass}"
                      echo "${params.unix_user}"
                     }
           }
            stage('psql log cleanup') {
            steps {
            script {
            def machines = ${params.db_server_list}
               for ( db_server in machines ) {
               sh "sshpass -p ${EXAMPLE_CREDS_PSW} ssh ${EXAMPLE_CREDS_USR}@\${db_server} "bash" < ./postgresql/clean-postgreslog.sh"
               }
             }
           } 
        }
    }
}
