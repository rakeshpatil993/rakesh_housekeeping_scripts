pipeline{
    agent any
   
stages {
            stage('check input parameter'){
            steps{
                      echo "${params.db_server_list}"
                      echo "${params.unix_user_pass}"
                      echo "${params.unix_user}"
                     }
           }
            stage('psql log cleanup') {
            steps {
            script {
            def machines = ${params.db_server_list}
            def userpass = ${params.unix_user_pass}
            def user = ${params.unix_user}
               for ( db_server in machines ) {
               sh "sshpass -p userpass ssh user@\${db_server} "bash" < ./postgresql/clean-postgreslog.sh"
               }
             }
           } 
        }
    }
}
